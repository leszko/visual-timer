<!DOCTYPE html>
<html>
<body>
	<div> 
		<p id="demo"></p>
	</div>
	<div>
		<button onclick="restart()">Restart</button>
		<input type="number" id="minutes" value="0.1">
	</div>

<canvas id="canvas" width="400" height="400"
style="background-color:#28c1bb">
</canvas>

<script type="text/javascript" src="rgbcolor.js"></script>

<script>
resizeFullScreen();

var fullCircle = 1;

var canvas = document.getElementById("canvas");
var context = canvas.getContext("2d");
var halfSize = canvas.height / 2;
context.translate(halfSize, halfSize);
radius = halfSize * 0.90;
var startTime =  new Date().getTime() / 1000;
var limitInSeconds = 10;

var angle = 0.1
restart();

var	blue = "#28c1bb";
var white = "#ffffff";
var orange = "#E89E0C";
var red = "#FF0000";

var previousColor = white;
var color = white;

var gradientLastChange = 0.0;

function restart() {
	clearCanvas();

	startTime =  new Date().getTime() / 1000;
	gradientLastChange = 0.0;
	limitInSeconds = document.getElementById("minutes").value * 60;
	window.requestAnimationFrame(drawClock);
}

function clearCanvas() {
	previousColor = white;
	color = white;
	context.translate(-halfSize, -halfSize);
	context.clearRect(0, 0, canvas.width, canvas.height);
	context.translate(halfSize, halfSize);
}

function drawClock() {
	drawProgress();

	refresh();
}

function refresh() {
	window.requestAnimationFrame(drawClock);
}

function drawProgress() {
	var currentTime = new Date().getTime() / 1000;
	var elapsedSeconds = (currentTime - startTime);
	var progress = elapsedSeconds / limitInSeconds;

	previousColor = color;
	color = applyGradient(previousColor, toColor(progress), elapsedSeconds);


	drawCircle(radius, progress, color);

	c = new RgbColor("#123456");
	document.getElementById("demo").innerHTML = c.toString();

	document.getElementById("demo").innerHTML = elapsedSeconds.toFixed(1);
}

function applyGradient(previousColor, currentColor, elapsedSeconds) {
	if (previousColor == currentColor) {
		return previousColor;
	}
	if (elapsedSeconds - gradientLastChange < 0.001) {
		return previousColor;
	}

	gradientLastChange = elapsedSeconds;

	var previousRgb = new RgbColor(previousColor);
	var currentRgb = new RgbColor(currentColor);

	previousRgb.applyGradientFrom(currentRgb);

	return previousRgb.toString();
}

function debug(text) {
	document.getElementById("demo").innerHTML = text;
}

function toColor(progress) {
	if (progress < 0.5) {
		return white;
	}
	if (progress < 0.8) {
		return orange;
	}
	return red;
}

function drawCircle(radius, progress, color) {
	context.lineWidth = 1;
	context.fillStyle = color;
	context.strokeStyle = color;
	context.beginPath();
    context.moveTo(0,0);
	context.arc(0, 0, radius, -0.5 * Math.PI, toAngle(progress));
	context.stroke();
	context.fill();
	context.closePath();
}

function toAngle(progress) {
	return (2 * progress - 0.5) * Math.PI;
}

function resizeFullScreen() {
	var canvas = document.getElementById("canvas");
	canvas.width  = window.innerWidth - 100;
	canvas.height = window.innerHeight - 100;
}

</script>

</body>
</html>
